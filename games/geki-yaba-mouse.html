<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GEKI YABA MOUSE | 激ヤバ・マウス</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Bangers&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #000;
            --ui-gold: #ffcc00;
            --ui-red: #ff3300;
            --ui-blue: #00ccff;
        }

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            overflow: hidden; background: var(--bg);
            font-family: 'Bangers', cursive;
        }

        #game-container {
            position: relative; width: 100vw; height: 100vh;
            display: flex; align-items: center; justify-content: center;
        }

        canvas { display: block; z-index: 1; touch-action: none; }

        /* UI Overlays */
        .ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 10; padding: 20px;
            box-sizing: border-box; display: flex; flex-direction: column;
            justify-content: space-between;
        }

        .header { display: flex; justify-content: space-between; align-items: center; }
        
        .death-counter { 
            background: rgba(255, 0, 0, 0.2); border: 2px solid var(--ui-red);
            padding: 5px 20px; border-radius: 10px; color: var(--ui-red); font-size: 2rem;
            text-shadow: 0 0 10px rgba(255,0,0,0.5);
        }

        .mode-indicator {
            font-size: 1.5rem; letter-spacing: 2px; text-transform: uppercase;
        }

        /* Screens */
        .overlay {
            position: absolute; inset: 0; background: rgba(0,0,0,0.9);
            display: flex; align-items: center; justify-content: center; z-index: 100;
        }

        .content { text-align: center; }
        h1 { font-size: 6rem; margin: 0; color: var(--ui-gold); line-height: 0.9; text-shadow: 5px 5px var(--ui-red); }
        .japanese { font-size: 2rem; display: block; color: white; }

        .btn {
            background: var(--ui-gold); border: none; padding: 20px 60px;
            font-family: 'Bangers'; font-size: 2.5rem; color: black;
            cursor: pointer; pointer-events: auto; margin-top: 20px;
            clip-path: polygon(10% 0%, 100% 0%, 90% 100%, 0% 100%);
            transition: transform 0.1s;
        }
        .btn:active { transform: scale(0.95); }

        .hidden { display: none; }
        
        .tutorial {
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            display: flex; gap: 20px; color: rgba(255,255,255,0.5); font-size: 1.2rem;
        }
    </style>
</head>
<body>

<div id="game-container">
    <div class="ui-layer">
        <div class="header">
            <div id="death-display" class="death-counter">DEATHS: 0</div>
            <div id="distance" style="font-size: 2.5rem; color: white;">0m</div>
        </div>
        <div id="mode-text" class="mode-indicator">NORMAL MODE</div>
    </div>

    <div id="start-screen" class="overlay">
        <div class="content">
            <h1>GEKI YABA<br><span style="font-size: 8rem;">MOUSE</span></h1>
            <span class="japanese">激ヤバ・マウス</span>
            <button class="btn" onclick="initGame()">GO!!</button>
            <div class="tutorial">
                <span>SPACE: JUMP</span>
                <span style="color: var(--ui-red);">DOWN: RAGE (Break Walls)</span>
                <span style="color: var(--ui-blue);">UP: SPEED (Slide)</span>
            </div>
        </div>
    </div>

    <canvas id="gameCanvas"></canvas>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
let w, h, deaths = 0, distance = 0, gameActive = false;
let gameSpeed = 8;
let state = 'NORMAL'; // NORMAL, RAGE, SPEED
let shake = 0, flash = 0;
let obstacles = [], particles = [], collectibles = [];

const mouse = {
    x: 200, y: 0, w: 50, h: 50, vy: 0,
    gravity: 0.9, jump: -18,
    onGround: false, anim: 0
};

const resize = () => {
    w = canvas.width = window.innerWidth;
    h = canvas.height = window.innerHeight;
};
window.addEventListener('resize', resize);
resize();

// --- INPUT HANDLER ---
const keys = {};
window.addEventListener('keydown', e => {
    keys[e.code] = true;
    if(e.code === 'Space' && mouse.onGround) mouse.vy = mouse.jump;
    updateState();
});
window.addEventListener('keyup', e => {
    keys[e.code] = false;
    updateState();
});

function updateState() {
    if(keys['ArrowDown']) {
        state = 'RAGE';
        document.getElementById('mode-text').innerText = "RAGE MODE (BREAK!)";
        document.getElementById('mode-text').style.color = "var(--ui-red)";
    } else if(keys['ArrowUp']) {
        state = 'SPEED';
        document.getElementById('mode-text').innerText = "SPEED MODE (SLIDE!)";
        document.getElementById('mode-text').style.color = "var(--ui-blue)";
    } else {
        state = 'NORMAL';
        document.getElementById('mode-text').innerText = "NORMAL MODE";
        document.getElementById('mode-text').style.color = "white";
    }
}

function initGame() {
    gameActive = true;
    deaths = 0; distance = 0; gameSpeed = 8;
    obstacles = []; collectibles = []; particles = [];
    document.getElementById('start-screen').classList.add('hidden');
    requestAnimationFrame(loop);
}

function spawn() {
    if(!gameActive) return;
    const chance = Math.random();
    if(chance < 0.02) {
        // Obstacle types: spike, wall (requires rage), low (requires slide)
        const types = ['spike', 'wall', 'low'];
        const type = types[Math.floor(Math.random() * types.length)];
        obstacles.push({ x: w + 100, y: h - 150, type, w: 60, h: type === 'low' ? 120 : 60 });
    }
    if(Math.random() < 0.03) {
        collectibles.push({ x: w + 100, y: h - 180 - Math.random() * 200, size: 25 });
    }
    setTimeout(spawn, 400 - Math.min(distance/10, 200));
}

function die() {
    deaths++;
    shake = 20;
    flash = 1;
    gameSpeed = 8;
    obstacles = [];
    distance = Math.max(0, distance - 50);
    document.getElementById('death-display').innerText = `DEATHS: ${deaths}`;
    // Instant Restart Particle Effect
    for(let i=0; i<30; i++) particles.push({ x: mouse.x, y: mouse.y, vx: (Math.random()-0.5)*20, vy: (Math.random()-0.5)*20, c: '#fff', life: 1 });
}

function loop() {
    if(!gameActive) return;
    
    // Background
    ctx.fillStyle = '#111';
    ctx.fillRect(0,0,w,h);
    
    // Camera Shake
    ctx.save();
    if(shake > 0) {
        ctx.translate((Math.random()-0.5)*shake, (Math.random()-0.5)*shake);
        shake *= 0.9;
    }

    // Floor
    ctx.fillStyle = '#333';
    ctx.fillRect(0, h-100, w, 100);

    // Mouse Physics
    mouse.vy += mouse.gravity;
    mouse.y += mouse.vy;
    if(mouse.y > h - 150) {
        mouse.y = h - 150;
        mouse.vy = 0;
        mouse.onGround = true;
    } else {
        mouse.onGround = false;
    }

    distance += Math.floor(gameSpeed/5);
    gameSpeed += 0.002;
    document.getElementById('distance').innerText = `${distance}m`;

    // Draw Mouse
    ctx.save();
    ctx.translate(mouse.x, mouse.y);
    let mColor = '#888';
    if(state === 'RAGE') mColor = '#ff3300';
    if(state === 'SPEED') {
        mColor = '#00ccff';
        ctx.scale(1.5, 0.5); // Squish for slide
        ctx.translate(0, 25);
    }
    
    // Body
    ctx.fillStyle = mColor;
    ctx.beginPath(); ctx.ellipse(0, 0, 25, 25, 0, 0, 7); ctx.fill();
    // Eyes (Intense)
    ctx.fillStyle = 'white';
    ctx.fillRect(5, -10, 15, 5); ctx.fillStyle = 'black'; ctx.fillRect(15, -10, 5, 5);
    ctx.restore();

    // Obstacles
    for(let i=obstacles.length-1; i>=0; i--) {
        let o = obstacles[i];
        o.x -= gameSpeed;
        
        if(o.type === 'spike') {
            ctx.fillStyle = '#ff00ff';
            ctx.beginPath(); ctx.moveTo(o.x, o.y+50); ctx.lineTo(o.x+30, o.y-10); ctx.lineTo(o.x+60, o.y+50); ctx.fill();
        } else if(o.type === 'wall') {
            ctx.fillStyle = '#ffcc00';
            ctx.fillRect(o.x, o.y-10, o.w, 60);
        } else if(o.type === 'low') {
            ctx.fillStyle = '#555';
            ctx.fillRect(o.x, 0, 40, h-180); // Ceiling obstacle
        }

        // Collision Logic
        let hitbox = { x: mouse.x - 20, y: mouse.y - 20, w: 40, h: 40 };
        if(state === 'SPEED') hitbox.h = 20;

        if(Math.abs(o.x - mouse.x) < 50) {
            if(o.type === 'spike') die();
            if(o.type === 'wall') {
                if(state === 'RAGE') {
                    shake = 10;
                    obstacles.splice(i, 1);
                    continue;
                } else die();
            }
            if(o.type === 'low') {
                if(state !== 'SPEED' && mouse.y < h - 150) die(); // Air hit
                if(mouse.y > h - 180 && state !== 'SPEED') die();
            }
        }
        if(o.x < -100) obstacles.splice(i, 1);
    }

    // Collectibles
    collectibles.forEach((c, i) => {
        c.x -= gameSpeed;
        ctx.fillStyle = '#ffcc00';
        ctx.beginPath(); ctx.arc(c.x, c.y, 15, 0, 7); ctx.fill();
        if(Math.hypot(c.x - mouse.x, c.y - mouse.y) < 40) {
            distance += 100;
            collectibles.splice(i, 1);
        }
    });

    // Particles
    particles.forEach((p, i) => {
        p.x += p.vx; p.y += p.vy; p.life -= 0.02;
        ctx.fillStyle = `rgba(255,255,255,${p.life})`;
        ctx.fillRect(p.x, p.y, 4, 4);
        if(p.life <= 0) particles.splice(i, 1);
    });

    ctx.restore();

    // Flash Effect
    if(flash > 0) {
        ctx.fillStyle = `rgba(255,255,255,${flash})`;
        ctx.fillRect(0,0,w,h);
        flash -= 0.1;
    }

    requestAnimationFrame(loop);
}

// Start spawner
spawn();
</script>
</body>
</html>
